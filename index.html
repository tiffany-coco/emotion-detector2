<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'å¾®è½¯é›…é»‘', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #4a4a4a;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stage-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* æ¸¸æˆé€‰æ‹© */
        .game-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .game-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            text-align: center;
            margin: 30px 0;
            min-height: 300px;
        }

        .target {
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5em;
            margin: 20px 0;
            display: inline-block;
        }

        .emoji-large {
            font-size: 80px;
            margin: 20px 0;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .option {
            background: white;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .option:hover {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-danger {
            background: #f44336;
        }

        /* ç»“æœåé¦ˆ */
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2em;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .score {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 200px;
            font-size: 1.5em;
            font-weight: bold;
        }

        /* å¯¼èˆª */
        .navigation {
            text-align: center;
            margin-top: 30px;
        }

        .nav-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 0 10px;
            text-decoration: none;
            display: inline-block;
        }

        @media (max-width: 600px) {
            .game-selection {
                grid-template-columns: 1fr;
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸµ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ„ŸçŸ¥ä¸è¯†åˆ«</h1>
            <p>å»ºç«‹æƒ…ç»ªåç§°ä¸è¡¨æƒ…çš„åˆæ­¥é“¾æ¥</p>
        </div>

        <div class="stage-info">
            <p>è¿™ä¸ªé˜¶æ®µå¸®åŠ©å­©å­å»ºç«‹æƒ…ç»ªè¯æ±‡ä¸è¡¨æƒ…çš„å¯¹åº”å…³ç³»ï¼ŒåŸ¹å…»åŸºç¡€çš„æƒ…ç»ªè¯†åˆ«èƒ½åŠ›ã€‚</p>
        </div>

        <!-- æ¸¸æˆé€‰æ‹© -->
        <div class="game-selection">
            <button class="game-btn" onclick="startGame('identification')">æƒ…ç»ªæŒ‡è®¤æ¸¸æˆ</button>
            <button class="game-btn" onclick="startGame('matching')">æƒ…ç»ªé…å¯¹æ¸¸æˆ</button>
            <button class="game-btn" onclick="startGame('imitation')">æƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ</button>
        </div>

        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area" id="gameArea">
            <p>è¯·é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¼€å§‹</p>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div class="controls">
            <button class="btn btn-success" onclick="nextRound()">ä¸‹ä¸€é¢˜</button>
            <button class="btn" onclick="showManualJudgment()">æ‰‹åŠ¨åˆ¤æ–­</button>
            <button class="btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            <button class="btn btn-danger" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
        </div>

        <!-- åˆ†æ•°æ˜¾ç¤º -->
        <div class="score">
            å¾—åˆ†: <span id="score">0</span>
        </div>

        <!-- å¯¼èˆª -->
        <div class="navigation">
            <a href="stage2.html" class="nav-btn">è¿›å…¥ç¬¬äºŒé˜¶æ®µ â†’</a>
        </div>
    </div>

    <script>
        // æƒ…ç»ªåº“
        const emotions = ['é«˜å…´', 'ä¼¤å¿ƒ', 'æƒŠè®¶', 'ç”Ÿæ°”', 'åŒæ¶', 'ææƒ§'];
        const emotionIcons = {
            'é«˜å…´': 'ğŸ˜Š',
            'ä¼¤å¿ƒ': 'ğŸ˜¢', 
            'æƒŠè®¶': 'ğŸ˜²',
            'ç”Ÿæ°”': 'ğŸ˜ ',
            'åŒæ¶': 'ğŸ¤¢',
            'ææƒ§': 'ğŸ˜¨'
        };

        // æ¸¸æˆçŠ¶æ€
        let currentGame = null;
        let currentTarget = null;
        let score = 0;
        let gameData = [];

        // å¼€å§‹æ¸¸æˆ
        function startGame(gameType) {
            currentGame = gameType;
            resetGameArea();
            
            switch(gameType) {
                case 'identification':
                    startIdentificationGame();
                    break;
                case 'matching':
                    startMatchingGame();
                    break;
                case 'imitation':
                    startImitationGame();
                    break;
            }
        }

        // æƒ…ç»ªæŒ‡è®¤æ¸¸æˆ
        function startIdentificationGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            let options = [currentTarget];
            while (options.length < 4) {
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                if (!options.includes(randomEmotion)) {
                    options.push(randomEmotion);
                }
            }
            
            options = shuffleArray(options);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">è¿™æ˜¯ä»€ä¹ˆæƒ…ç»ªï¼Ÿ ${emotionIcons[currentTarget]}</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(emotion => {
                const option = document.createElement('div');
                option.className = 'option';
                option.textContent = emotion;
                option.onclick = () => checkAnswer(emotion);
                optionsContainer.appendChild(option);
            });
        }

        // æƒ…ç»ªé…å¯¹æ¸¸æˆ
        function startMatchingGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            let options = [
                { emotion: currentTarget, icon: emotionIcons[currentTarget] },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) }
            ];
            
            let differentEmotion;
            do {
                differentEmotion = emotions[Math.floor(Math.random() * emotions.length)];
            } while (differentEmotion === currentTarget);
            
            options.push({ emotion: differentEmotion, icon: emotionIcons[differentEmotion] });
            
            options = shuffleArray(options);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">è¯·æ‰¾å‡ºæ‰€æœ‰${currentTarget}çš„è¡¨æƒ…</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(item => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = item.icon;
                option.onclick = () => checkMatchingAnswer(item.emotion === currentTarget);
                optionsContainer.appendChild(option);
            });
        }

        // æƒ…ç»ªæ¨¡ä»¿æ¸¸æˆ
        function startImitationGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            const hints = {
                'é«˜å…´': "å˜´è§’ä¸Šæ‰¬ï¼Œçœ¼ç›çœ¯èµ·",
                'ä¼¤å¿ƒ': "å˜´è§’ä¸‹å‚ï¼Œçœ¼çœ¶æ¹¿æ¶¦", 
                'æƒŠè®¶': "çœ¼ç›çå¤§ï¼Œå˜´å·´å¼ å¼€",
                'ç”Ÿæ°”': "çœ‰å¤´ç´§é”ï¼Œå˜´è§’ä¸‹æ‹‰",
                'åŒæ¶': "é¼»å­çš±èµ·ï¼Œå˜´è§’æ­ªæ–œ",
                'ææƒ§': "çœ¼ç›çå¤§ï¼Œå˜´å·´å¼ å¼€"
            };
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">è¯·æ¨¡ä»¿è¿™ä¸ªè¡¨æƒ…ï¼š${emotionIcons[currentTarget]} ${currentTarget}</div>
                <div class="emoji-large">${emotionIcons[currentTarget]}</div>
                <div style="margin: 20px 0; font-size: 1.2em; color: #666;">
                    ${hints[currentTarget]}
                </div>
                <p style="margin: 20px 0;">åšå‡ºè¡¨æƒ…åï¼Œè¯·è€å¸ˆç‚¹å‡»"æ‰‹åŠ¨åˆ¤æ–­"æŒ‰é’®</p>
            `;
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer(selectedEmotion) {
            const isCorrect = selectedEmotion === currentTarget;
            
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: selectedEmotion,
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            showFeedback(isCorrect, isCorrect ? 
                `å¤ªæ£’äº†ï¼ç­”å¯¹äº†ï¼è¿™æ˜¯${currentTarget}` : 
                `ä¸å¯¹å“¦ï¼Œè¿™æ˜¯${currentTarget}`);
            
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // æ£€æŸ¥é…å¯¹ç­”æ¡ˆ
        function checkMatchingAnswer(isCorrect) {
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: isCorrect ? "æ­£ç¡®é…å¯¹" : "é”™è¯¯é…å¯¹",
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            showFeedback(isCorrect, isCorrect ? 
                `å¤ªæ£’äº†ï¼è¿™æ˜¯${currentTarget}çš„è¡¨æƒ…` : 
                `ä¸å¯¹å“¦ï¼Œè¿™ä¸æ˜¯${currentTarget}çš„è¡¨æƒ…`);
            
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(isSuccess, message) {
            const oldFeedback = document.querySelector('.feedback');
            if (oldFeedback) {
                oldFeedback.remove();
            }
            
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isSuccess ? 'success' : 'error'}`;
            feedback.textContent = message;
            
            document.getElementById('gameArea').appendChild(feedback);
            feedback.style.display = 'block';
        }

        // ä¸‹ä¸€é¢˜
        function nextRound() {
            if (currentGame) {
                startGame(currentGame);
            }
        }

        // æ‰‹åŠ¨åˆ¤æ–­
        function showManualJudgment() {
            if (!currentGame || !currentTarget) {
                alert("è¯·å…ˆå¼€å§‹ä¸€ä¸ªæ¸¸æˆ");
                return;
            }
            
            const manualChoice = prompt(`è¯·æ‰‹åŠ¨åˆ¤æ–­æ­£ç¡®æƒ…ç»ªï¼ˆå½“å‰ç›®æ ‡: ${currentTarget}ï¼‰:\n${emotions.join(', ')}`);
            if (manualChoice && emotions.includes(manualChoice)) {
                checkAnswer(manualChoice);
            } else if (manualChoice) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æƒ…ç»ªåç§°");
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (gameData.length === 0) {
                alert("è¿˜æ²¡æœ‰æ¸¸æˆæ•°æ®å¯ä»¥å¯¼å‡º");
                return;
            }
            
            let csvContent = "æ—¶é—´,æ¸¸æˆç±»å‹,ç›®æ ‡æƒ…ç»ª,é€‰æ‹©æƒ…ç»ª,æ˜¯å¦æ­£ç¡®\n";
            gameData.forEach(record => {
                csvContent += `"${record.timestamp}","${record.game}","${record.target}","${record.selected}","${record.correct ? 'æ˜¯' : 'å¦'}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `ç¬¬ä¸€é˜¶æ®µæ•°æ®_${new Date().getTime()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            currentGame = null;
            currentTarget = null;
            score = 0;
            gameData = [];
            document.getElementById('score').textContent = '0';
            resetGameArea();
        }

        // é‡ç½®æ¸¸æˆåŒºåŸŸ
        function resetGameArea() {
            document.getElementById('gameArea').innerHTML = '<p>è¯·é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¼€å§‹</p>';
        }

        // å·¥å…·å‡½æ•°
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getSimilarEmoji(emotion) {
            const variations = {
                'é«˜å…´': ['ğŸ˜„', 'ğŸ˜ƒ', 'ğŸ˜€', 'ğŸ˜Š', 'ğŸ˜'],
                'ä¼¤å¿ƒ': ['ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜”', 'ğŸ˜', 'ğŸ˜¥'],
                'æƒŠè®¶': ['ğŸ˜²', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ™€', 'ğŸ˜§'],
                'ç”Ÿæ°”': ['ğŸ˜ ', 'ğŸ˜¡', 'ğŸ‘¿', 'ğŸ’¢', 'ğŸ˜¤'],
                'åŒæ¶': ['ğŸ¤¢', 'ğŸ¤®', 'ğŸ˜·', 'ğŸ˜–', 'ğŸ˜£'],
                'ææƒ§': ['ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜±', 'ğŸ™€', 'ğŸ˜¬']
            };
            
            const options = variations[emotion] || [emotionIcons[emotion]];
            return options[Math.floor(Math.random() * options.length)];
        }
    </script>
</body>
</html>

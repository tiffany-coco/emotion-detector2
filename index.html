<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一阶段：基础感知与识别</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', '微软雅黑', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #4a4a4a;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stage-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        /* 游戏选择 */
        .game-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .game-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
        }

        /* 游戏区域 */
        .game-area {
            text-align: center;
            margin: 30px 0;
            min-height: 300px;
        }

        .target {
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5em;
            margin: 20px 0;
            display: inline-block;
        }

        .emoji-large {
            font-size: 80px;
            margin: 20px 0;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .option {
            background: white;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .option:hover {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
        }

        /* 控制按钮 */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-danger {
            background: #f44336;
        }

        /* 结果反馈 */
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2em;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .score {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 200px;
            font-size: 1.5em;
            font-weight: bold;
        }

        /* 导航 */
        .navigation {
            text-align: center;
            margin-top: 30px;
        }

        .nav-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            margin: 0 10px;
            text-decoration: none;
            display: inline-block;
        }

        @media (max-width: 600px) {
            .game-selection {
                grid-template-columns: 1fr;
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎵 第一阶段：基础感知与识别</h1>
            <p>建立情绪名称与表情的初步链接</p>
        </div>

        <div class="stage-info">
            <p>这个阶段帮助孩子建立情绪词汇与表情的对应关系，培养基础的情绪识别能力。</p>
        </div>

        <!-- 游戏选择 -->
        <div class="game-selection">
            <button class="game-btn" onclick="startGame('identification')">情绪指认游戏</button>
            <button class="game-btn" onclick="startGame('matching')">情绪配对游戏</button>
            <button class="game-btn" onclick="startGame('imitation')">情绪模仿游戏</button>
        </div>

        <!-- 游戏区域 -->
        <div class="game-area" id="gameArea">
            <p>请选择一个游戏开始</p>
        </div>

        <!-- 控制按钮 -->
        <div class="controls">
            <button class="btn btn-success" onclick="nextRound()">下一题</button>
            <button class="btn" onclick="showManualJudgment()">手动判断</button>
            <button class="btn" onclick="exportData()">导出数据</button>
            <button class="btn btn-danger" onclick="resetGame()">重新开始</button>
        </div>

        <!-- 分数显示 -->
        <div class="score">
            得分: <span id="score">0</span>
        </div>

        <!-- 导航 -->
        <div class="navigation">
            <a href="stage2.html" class="nav-btn">进入第二阶段 →</a>
        </div>
    </div>

    <script>
        // 情绪库
        const emotions = ['高兴', '伤心', '惊讶', '生气', '厌恶', '恐惧'];
        const emotionIcons = {
            '高兴': '😊',
            '伤心': '😢', 
            '惊讶': '😲',
            '生气': '😠',
            '厌恶': '🤢',
            '恐惧': '😨'
        };

        // 游戏状态
        let currentGame = null;
        let currentTarget = null;
        let score = 0;
        let gameData = [];

        // 开始游戏
        function startGame(gameType) {
            currentGame = gameType;
            resetGameArea();
            
            switch(gameType) {
                case 'identification':
                    startIdentificationGame();
                    break;
                case 'matching':
                    startMatchingGame();
                    break;
                case 'imitation':
                    startImitationGame();
                    break;
            }
        }

        // 情绪指认游戏
        function startIdentificationGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            let options = [currentTarget];
            while (options.length < 4) {
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                if (!options.includes(randomEmotion)) {
                    options.push(randomEmotion);
                }
            }
            
            options = shuffleArray(options);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">这是什么情绪？ ${emotionIcons[currentTarget]}</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(emotion => {
                const option = document.createElement('div');
                option.className = 'option';
                option.textContent = emotion;
                option.onclick = () => checkAnswer(emotion);
                optionsContainer.appendChild(option);
            });
        }

        // 情绪配对游戏
        function startMatchingGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            let options = [
                { emotion: currentTarget, icon: emotionIcons[currentTarget] },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) }
            ];
            
            let differentEmotion;
            do {
                differentEmotion = emotions[Math.floor(Math.random() * emotions.length)];
            } while (differentEmotion === currentTarget);
            
            options.push({ emotion: differentEmotion, icon: emotionIcons[differentEmotion] });
            
            options = shuffleArray(options);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">请找出所有${currentTarget}的表情</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(item => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = item.icon;
                option.onclick = () => checkMatchingAnswer(item.emotion === currentTarget);
                optionsContainer.appendChild(option);
            });
        }

        // 情绪模仿游戏
        function startImitationGame() {
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            const hints = {
                '高兴': "嘴角上扬，眼睛眯起",
                '伤心': "嘴角下垂，眼眶湿润", 
                '惊讶': "眼睛睁大，嘴巴张开",
                '生气': "眉头紧锁，嘴角下拉",
                '厌恶': "鼻子皱起，嘴角歪斜",
                '恐惧': "眼睛睁大，嘴巴张开"
            };
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">请模仿这个表情：${emotionIcons[currentTarget]} ${currentTarget}</div>
                <div class="emoji-large">${emotionIcons[currentTarget]}</div>
                <div style="margin: 20px 0; font-size: 1.2em; color: #666;">
                    ${hints[currentTarget]}
                </div>
                <p style="margin: 20px 0;">做出表情后，请老师点击"手动判断"按钮</p>
            `;
        }

        // 检查答案
        function checkAnswer(selectedEmotion) {
            const isCorrect = selectedEmotion === currentTarget;
            
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: selectedEmotion,
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            showFeedback(isCorrect, isCorrect ? 
                `太棒了！答对了！这是${currentTarget}` : 
                `不对哦，这是${currentTarget}`);
            
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // 检查配对答案
        function checkMatchingAnswer(isCorrect) {
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: isCorrect ? "正确配对" : "错误配对",
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            showFeedback(isCorrect, isCorrect ? 
                `太棒了！这是${currentTarget}的表情` : 
                `不对哦，这不是${currentTarget}的表情`);
            
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // 显示反馈
        function showFeedback(isSuccess, message) {
            const oldFeedback = document.querySelector('.feedback');
            if (oldFeedback) {
                oldFeedback.remove();
            }
            
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isSuccess ? 'success' : 'error'}`;
            feedback.textContent = message;
            
            document.getElementById('gameArea').appendChild(feedback);
            feedback.style.display = 'block';
        }

        // 下一题
        function nextRound() {
            if (currentGame) {
                startGame(currentGame);
            }
        }

        // 手动判断
        function showManualJudgment() {
            if (!currentGame || !currentTarget) {
                alert("请先开始一个游戏");
                return;
            }
            
            const manualChoice = prompt(`请手动判断正确情绪（当前目标: ${currentTarget}）:\n${emotions.join(', ')}`);
            if (manualChoice && emotions.includes(manualChoice)) {
                checkAnswer(manualChoice);
            } else if (manualChoice) {
                alert("请输入有效的情绪名称");
            }
        }

        // 导出数据
        function exportData() {
            if (gameData.length === 0) {
                alert("还没有游戏数据可以导出");
                return;
            }
            
            let csvContent = "时间,游戏类型,目标情绪,选择情绪,是否正确\n";
            gameData.forEach(record => {
                csvContent += `"${record.timestamp}","${record.game}","${record.target}","${record.selected}","${record.correct ? '是' : '否'}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `第一阶段数据_${new Date().getTime()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 重置游戏
        function resetGame() {
            currentGame = null;
            currentTarget = null;
            score = 0;
            gameData = [];
            document.getElementById('score').textContent = '0';
            resetGameArea();
        }

        // 重置游戏区域
        function resetGameArea() {
            document.getElementById('gameArea').innerHTML = '<p>请选择一个游戏开始</p>';
        }

        // 工具函数
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getSimilarEmoji(emotion) {
            const variations = {
                '高兴': ['😄', '😃', '😀', '😊', '😁'],
                '伤心': ['😢', '😭', '😔', '😞', '😥'],
                '惊讶': ['😲', '😮', '😯', '🙀', '😧'],
                '生气': ['😠', '😡', '👿', '💢', '😤'],
                '厌恶': ['🤢', '🤮', '😷', '😖', '😣'],
                '恐惧': ['😨', '😰', '😱', '🙀', '😬']
            };
            
            const options = variations[emotion] || [emotionIcons[emotion]];
            return options[Math.floor(Math.random() * options.length)];
        }
    </script>
</body>
</html>

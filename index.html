<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>情绪识别小助手 - 特殊教育教具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', '微软雅黑', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #4a4a4a;
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* 游戏选择 */
        .game-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .game-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            background: #45a049;
            transform: translateY(-3px);
        }

        /* 游戏区域 */
        .game-area {
            text-align: center;
            margin: 30px 0;
            min-height: 300px;
        }

        .target {
            background: #ff6b6b;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.5em;
            margin: 20px 0;
            display: inline-block;
        }

        .emoji-large {
            font-size: 80px;
            margin: 20px 0;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .option {
            background: white;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }

        .option:hover {
            background: #4CAF50;
            color: white;
            transform: scale(1.05);
        }

        /* 控制按钮 */
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-danger {
            background: #f44336;
        }

        /* 结果反馈 */
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2em;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .score {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px auto;
            max-width: 200px;
            font-size: 1.5em;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .game-selection {
                grid-template-columns: 1fr;
            }
            
            .options {
                flex-direction: column;
                align-items: center;
            }
            
            .option {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎭 情绪识别小助手</h1>
            <p>特殊教育互动教学工具</p>
        </div>

        <!-- 游戏选择 -->
        <div class="game-selection">
            <button class="game-btn" onclick="startGame('identification')">情绪指认游戏</button>
            <button class="game-btn" onclick="startGame('matching')">情绪配对游戏</button>
            <button class="game-btn" onclick="startGame('situation')">情境配对游戏</button>
            <button class="game-btn" onclick="startGame('eliminate')">消除坏情绪</button>
        </div>

        <!-- 游戏区域 -->
        <div class="game-area" id="gameArea">
            <p>请选择一个游戏开始</p>
        </div>

        <!-- 控制按钮 -->
        <div class="controls">
            <button class="btn btn-success" onclick="nextRound()">下一题</button>
            <button class="btn" onclick="showManualJudgment()">手动判断</button>
            <button class="btn" onclick="exportData()">导出数据</button>
            <button class="btn btn-danger" onclick="resetGame()">重新开始</button>
        </div>

        <!-- 分数显示 -->
        <div class="score">
            得分: <span id="score">0</span>
        </div>
    </div>

    <script>
        // 情绪库
        const emotions = ['高兴', '伤心', '惊讶', '生气', '厌恶', '恐惧'];
        const emotionIcons = {
            '高兴': '😊',
            '伤心': '😢', 
            '惊讶': '😲',
            '生气': '😠',
            '厌恶': '🤢',
            '恐惧': '😨'
        };

        // 负面情绪（用于消除游戏）
        const negativeEmotions = ['生气', '伤心', '厌恶', '恐惧'];

        // 情境库
        const situations = [
            { situation: "收到生日礼物", emotion: "高兴" },
            { situation: "玩具被弄坏了", emotion: "伤心" },
            { situation: "突然听到巨响", emotion: "惊讶" },
            { situation: "被同学推了一下", emotion: "生气" },
            { situation: "闻到难闻气味", emotion: "厌恶" },
            { situation: "在黑暗中独处", emotion: "恐惧" }
        ];

        // 游戏状态
        let currentGame = null;
        let currentTarget = null;
        let score = 0;
        let gameData = [];

        // 开始游戏
        function startGame(gameType) {
            currentGame = gameType;
            resetGameArea();
            
            switch(gameType) {
                case 'identification':
                    startIdentificationGame();
                    break;
                case 'matching':
                    startMatchingGame();
                    break;
                case 'situation':
                    startSituationGame();
                    break;
                case 'eliminate':
                    startEliminateGame();
                    break;
            }
        }

        // 情绪指认游戏
        function startIdentificationGame() {
            // 随机选择目标情绪
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            // 创建选项（包含正确答案和3个错误答案）
            let options = [currentTarget];
            while (options.length < 4) {
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                if (!options.includes(randomEmotion)) {
                    options.push(randomEmotion);
                }
            }
            
            // 打乱选项顺序
            options = shuffleArray(options);
            
            // 更新界面
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">请识别这个情绪: ${emotionIcons[currentTarget]}</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(emotion => {
                const option = document.createElement('div');
                option.className = 'option';
                option.textContent = emotion;
                option.onclick = () => checkAnswer(emotion);
                optionsContainer.appendChild(option);
            });
        }

        // 情绪配对游戏
        function startMatchingGame() {
            // 随机选择目标情绪
            currentTarget = emotions[Math.floor(Math.random() * emotions.length)];
            
            // 创建选项（包含3个相同情绪的不同emoji和1个不同情绪）
            let options = [
                { emotion: currentTarget, icon: emotionIcons[currentTarget] },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) },
                { emotion: currentTarget, icon: getSimilarEmoji(currentTarget) }
            ];
            
            // 添加一个不同情绪的选项
            let differentEmotion;
            do {
                differentEmotion = emotions[Math.floor(Math.random() * emotions.length)];
            } while (differentEmotion === currentTarget);
            
            options.push({ emotion: differentEmotion, icon: emotionIcons[differentEmotion] });
            
            // 打乱选项顺序
            options = shuffleArray(options);
            
            // 更新界面
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">请找出所有${currentTarget}的表情</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(item => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = item.icon;
                option.onclick = () => checkMatchingAnswer(item.emotion === currentTarget);
                optionsContainer.appendChild(option);
            });
        }

        // 情境配对游戏
        function startSituationGame() {
            // 随机选择情境
            const situation = situations[Math.floor(Math.random() * situations.length)];
            currentTarget = situation.emotion;
            
            // 创建选项（包含正确答案和3个错误答案）
            let options = [situation.emotion];
            while (options.length < 4) {
                const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                if (!options.includes(randomEmotion)) {
                    options.push(randomEmotion);
                }
            }
            
            // 打乱选项顺序
            options = shuffleArray(options);
            
            // 更新界面
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">${situation.situation}，应该是什么情绪？</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            options.forEach(emotion => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = `${emotion} ${emotionIcons[emotion]}`;
                option.onclick = () => checkAnswer(emotion);
                optionsContainer.appendChild(option);
            });
        }

        // 消除坏情绪游戏
        function startEliminateGame() {
            // 创建情绪泡泡（混合正面和负面情绪）
            let emotionBubbles = [];
            
            // 添加2-3个负面情绪
            const numNegative = Math.floor(Math.random() * 2) + 2;
            for (let i = 0; i < numNegative; i++) {
                const emotion = negativeEmotions[Math.floor(Math.random() * negativeEmotions.length)];
                emotionBubbles.push({ emotion, isNegative: true });
            }
            
            // 添加2-3个正面情绪
            const positiveEmotions = ['高兴', '惊讶'];
            const numPositive = Math.floor(Math.random() * 2) + 2;
            for (let i = 0; i < numPositive; i++) {
                const emotion = positiveEmotions[Math.floor(Math.random() * positiveEmotions.length)];
                emotionBubbles.push({ emotion, isNegative: false });
            }
            
            // 打乱顺序
            emotionBubbles = shuffleArray(emotionBubbles);
            
            // 更新界面
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="target">请点击消除所有负面情绪（生气、伤心、厌恶、恐惧）</div>
                <div class="options" id="optionsContainer"></div>
            `;
            
            const optionsContainer = document.getElementById('optionsContainer');
            emotionBubbles.forEach(bubble => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = emotionIcons[bubble.emotion];
                option.dataset.emotion = bubble.emotion;
                option.dataset.isNegative = bubble.isNegative;
                option.onclick = function() {
                    checkEliminateAnswer(this);
                };
                optionsContainer.appendChild(option);
            });
            
            // 重置当前目标（这个游戏没有单一目标）
            currentTarget = null;
        }

        // 检查答案（通用）
        function checkAnswer(selectedEmotion) {
            const isCorrect = selectedEmotion === currentTarget;
            
            // 记录结果
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: selectedEmotion,
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            // 显示反馈
            showFeedback(isCorrect, isCorrect ? 
                `太棒了！答对了！这是${currentTarget}` : 
                `不对哦，这是${currentTarget}`);
            
            // 更新分数
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // 检查配对答案
        function checkMatchingAnswer(isCorrect) {
            // 记录结果
            gameData.push({
                game: currentGame,
                target: currentTarget,
                selected: isCorrect ? "正确配对" : "错误配对",
                correct: isCorrect,
                timestamp: new Date().toISOString()
            });
            
            // 显示反馈
            showFeedback(isCorrect, isCorrect ? 
                `太棒了！这是${currentTarget}的表情` : 
                `不对哦，这不是${currentTarget}的表情`);
            
            // 更新分数
            if (isCorrect) {
                score += 10;
                document.getElementById('score').textContent = score;
            }
        }

        // 检查消除游戏答案
        function checkEliminateAnswer(element) {
            const isNegative = element.dataset.isNegative === 'true';
            const emotion = element.dataset.emotion;
            
            // 记录结果
            gameData.push({
                game: currentGame,
                target: "消除负面情绪",
                selected: emotion,
                correct: isNegative,
                timestamp: new Date().toISOString()
            });
            
            if (isNegative) {
                // 正确消除负面情绪
                element.style.opacity = '0.3';
                element.style.transform = 'scale(0.8)';
                element.onclick = null; // 防止重复点击
                
                // 检查是否所有负面情绪都已消除
                const remainingNegative = document.querySelectorAll('.option[data-is-negative="true"]:not([style*="opacity: 0.3"])');
                if (remainingNegative.length === 0) {
                    showFeedback(true, "太棒了！所有负面情绪都已消除！");
                    score += 15;
                    document.getElementById('score').textContent = score;
                }
            } else {
                // 错误消除正面情绪
                showFeedback(false, `这是${emotion}，是正面情绪，不需要消除`);
            }
        }

        // 显示反馈
        function showFeedback(isSuccess, message) {
            // 移除之前的反馈
            const oldFeedback = document.querySelector('.feedback');
            if (oldFeedback) {
                oldFeedback.remove();
            }
            
            // 创建新反馈
            const feedback = document.createElement('div');
            feedback.className = `feedback ${isSuccess ? 'success' : 'error'}`;
            feedback.textContent = message;
            
            document.getElementById('gameArea').appendChild(feedback);
            feedback.style.display = 'block';
        }

        // 下一题
        function nextRound() {
            if (currentGame) {
                startGame(currentGame);
            }
        }

        // 手动判断
        function showManualJudgment() {
            if (!currentGame || !currentTarget) {
                alert("请先开始一个游戏");
                return;
            }
            
            const manualChoice = prompt(`请手动判断正确情绪（当前目标: ${currentTarget}）:\n${emotions.join(', ')}`);
            if (manualChoice && emotions.includes(manualChoice)) {
                checkAnswer(manualChoice);
            } else if (manualChoice) {
                alert("请输入有效的情绪名称");
            }
        }

        // 导出数据
        function exportData() {
            if (gameData.length === 0) {
                alert("还没有游戏数据可以导出");
                return;
            }
            
            let csvContent = "时间,游戏类型,目标情绪,选择情绪,是否正确\n";
            gameData.forEach(record => {
                csvContent += `"${record.timestamp}","${record.game}","${record.target}","${record.selected}","${record.correct ? '是' : '否'}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", `情绪游戏数据_${new Date().getTime()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 重置游戏
        function resetGame() {
            currentGame = null;
            currentTarget = null;
            score = 0;
            gameData = [];
            document.getElementById('score').textContent = '0';
            resetGameArea();
        }

        // 重置游戏区域
        function resetGameArea() {
            document.getElementById('gameArea').innerHTML = '<p>请选择一个游戏开始</p>';
        }

        // 工具函数
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getSimilarEmoji(emotion) {
            // 返回相同情绪的不同emoji表示
            const variations = {
                '高兴': ['😄', '😃', '😀', '😊', '😁'],
                '伤心': ['😢', '😭', '😔', '😞', '😥'],
                '惊讶': ['😲', '😮', '😯', '🙀', '😧'],
                '生气': ['😠', '😡', '👿', '💢', '😤'],
                '厌恶': ['🤢', '🤮', '😷', '😖', '😣'],
                '恐惧': ['😨', '😰', '😱', '🙀', '😬']
            };
            
            const options = variations[emotion] || [emotionIcons[emotion]];
            return options[Math.floor(Math.random() * options.length)];
        }
    </script>
</body>
</html>
